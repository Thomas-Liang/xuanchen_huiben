# 泫晨懿然·灵犀绘梦需求文档

## Sprint Backlog

### Sprint 1: 提示词解析与角色绑定系统

---

### Sprint 0: 项目初始化 (技术准备)

#### Task 0.1: Tauri + React 项目初始化

- **描述**: 使用官方脚手架创建Tauri + React项目
- **类型**: DevOps
- **预估时间**: 1h
- **负责人**: [待分配]

#### Task 0.2: 开发环境配置

- **描述**: 配置ESLint、Prettier、TypeScript等开发工具
- **类型**: DevOps
- **预估时间**: 1h
- **负责人**: [待分配]

#### Task 0.3: 项目结构搭建

- **描述**: 建立清晰的目录结构 (components/hooks/commands/types等)
- **类型**: Frontend
- **预估时间**: 1h
- **负责人**: [待分配]

---

## User Story

### US-001: 提示词分割功能

**标题**: 作为用户，我希望输入的提示词能够被自动分割，以便于后续处理

**优先级**: P0 (High)  
**故事点**: 5

**验收标准**:

- [ ] 用户输入一段完整提示词
- [ ] 系统能够识别并分割出场景描述、角色、动作、背景等不同部分
- [ ] 分割结果能够清晰展示给用户
- [ ] 支持中英文提示词

---

### US-002: 角色绑定功能

**标题**: 作为用户，我希望使用@符号能将提示词中的角色与参考图进行绑定

**优先级**: P0 (High)  
**故事点**: 8

**验收标准**:

- [ ] 用户可以使用@角色名来引用需要绑定的角色
- [ ] 用户可以上传或选择角色的参考图片 (人物/场景均可，可选)
- [ ] 系统能够将@角色与对应的参考图建立关联
- [ ] 支持多个角色同时绑定
- [ ] 绑定关系在生成图片时能够正确应用
- [ ] 参考图为可选，不绑定也可生成图片

---

### US-003: AI出图功能

**标题**: 作为用户，我希望能够选择即梦或banana pro模型进行AI出图

**优先级**: P0 (High)  
**故事点**: 8

**验收标准**:

- [ ] 支持选择即梦模型进行出图
- [ ] 支持选择banana pro模型进行出图
- [ ] 能够将分割后的提示词、绑定的角色参考图发送给AI模型
- [ ] 返回生成的图片结果
- [ ] 显示生成进度

---

### US-004: 出图参数配置

**标题**: 作为用户，我希望能够配置出图的相关参数

**优先级**: P1 (Medium)  
**故事点**: 3

**验收标准**:

- [ ] 支持配置图片尺寸
- [ ] 支持配置生成数量
- [ ] 支持配置画质/质量参数
- [ ] 参数能够保存为默认配置

---

### US-005: 桌面应用基础功能

**标题**: 作为用户，我希望应用具备桌面软件的基础体验

**优先级**: P1 (Medium)  
**故事点**: 3

**验收标准**:

- [ ] 窗口支持最小化、最大化、关闭
- [ ] 应用支持系统托盘运行
- [ ] 支持全局快捷键快速唤起
- [ ] 生成的图片支持本地保存

---

### US-007: 三方API配置

**标题**: 作为用户，我希望能够配置即梦和Banana Pro的API地址和密钥

**优先级**: P0 (High)  
**故事点**: 3

**验收标准**:

- [ ] 支持配置即梦API的Base URL
- [ ] 支持配置即梦API Key
- [ ] 支持配置Banana Pro API的Base URL
- [ ] 支持配置Banana Pro API Key
- [ ] 支持测试API连接是否可用
- [ ] API配置支持本地保存
- [ ] API配置支持加密存储

---

### US-006: 参考图管理

**标题**: 作为用户，我希望能够管理我的角色和场景参考图

**优先级**: P2 (Low)  
**故事点**: 3

**验收标准**:

- [ ] 支持查看已上传的参考图列表 (人物/场景)
- [ ] 支持删除不需要的参考图
- [ ] 参考图支持分类/标签管理
- [ ] 支持搜索参考图

---

## Task

### US-001 任务拆分

#### Task 1.1: 提示词输入界面开发

- **描述**: 创建提示词输入的UI界面
- **类型**: Frontend
- **预估时间**: 2h
- **负责人**: [待分配]

#### Task 1.2: 提示词分割引擎开发

- **描述**: 实现基于NLP的提示词分割逻辑 (Tauri Command)
- **类型**: Rust/Node.js
- **预估时间**: 4h
- **负责人**: [待分配]

#### Task 1.3: 分割结果展示组件

- **描述**: 将分割后的各部分以可视化方式展示
- **类型**: Frontend
- **预估时间**: 2h
- **负责人**: [待分配]

---

### US-002 任务拆分

#### Task 2.1: 角色参考图上传功能

- **描述**: 实现参考图上传和存储功能 (Tauri文件API)
- **类型**: Frontend + Tauri
- **预估时间**: 3h
- **负责人**: [待分配]

#### Task 2.2: @角色解析器开发

- **描述**: 解析提示词中的@角色标记，提取角色名 (Tauri Command)
- **类型**: Rust/Node.js
- **预估时间**: 2h
- **负责人**: [待分配]

#### Task 2.3: 角色绑定UI开发

- **描述**: 绑定界面，支持选择参考图进行关联
- **类型**: Frontend
- **预估时间**: 3h
- **负责人**: [待分配]

#### Task 2.4: 绑定关系数据模型设计

- **描述**: 设计角色绑定的数据结构并实现本地存储
- **类型**: Tauri (Rust)
- **预估时间**: 2h
- **负责人**: [待分配]

---

### US-003 任务拆分

#### Task 3.1: AI模型API集成（即梦）

- **描述**: 集成即梦模型API (Tauri Command)
- **类型**: Rust/Node.js
- **预估时间**: 4h
- **负责人**: [待分配]

#### Task 3.2: AI模型API集成（Banana Pro）

- **描述**: 集成Banana Pro模型API (Tauri Command)
- **类型**: Rust/Node.js
- **预估时间**: 4h
- **负责人**: [待分配]

#### Task 3.3: 出图请求服务开发

- **描述**: 封装出图请求逻辑，处理提示词和角色绑定
- **类型**: Rust/Node.js
- **预估时间**: 3h
- **负责人**: [待分配]

#### Task 3.4: 出图结果展示

- **描述**: 展示生成的图片，支持预览和下载
- **类型**: Frontend
- **预估时间**: 2h
- **负责人**: [待分配]

#### Task 3.5: 生成进度显示

- **描述**: 显示图片生成进度和状态
- **类型**: Frontend
- **预估时间**: 1h
- **负责人**: [待分配]

---

### US-004 任务拆分

#### Task 4.1: 参数配置UI开发

- **描述**: 创建参数配置面板
- **类型**: Frontend
- **预估时间**: 2h
- **负责人**: [待分配]

#### Task 4.2: 默认配置保存功能

- **描述**: 将用户配置的参数保存为默认值 (Tauri本地存储)
- **类型**: Tauri
- **预估时间**: 1h
- **负责人**: [待分配]

---

## 技术架构

### Tauri + React 桌面应用架构

```
┌─────────────────────────────────────────────────────────┐
│                    Tauri Desktop App                     │
│  ┌─────────────────┐           ┌─────────────────────┐  │
│  │   React Frontend │◀────────▶│  Tauri Commands    │  │
│  │   (TypeScript)   │  invoke  │  (Rust/Node.js)    │  │
│  └─────────────────┘           └─────────────────────┘  │
│                                          │               │
└──────────────────────────────────────────┼───────────────┘
                                           │
                              ┌────────────▼────────────┐
                              │     AI Model API        │
                              │ (即梦 / Banana Pro)      │
                              └─────────────────────────┘
```

### 技术栈

- **前端框架**: React 18 + TypeScript + Vite
- **桌面框架**: Tauri 2.x
- **UI组件**: Ant Design / Material UI / Tailwind CSS
- **状态管理**: Zustand / Redux Toolkit
- **HTTP请求**: Axios / Fetch
- **后端逻辑**: Tauri Commands (Rust) 或 Node.js

### 核心模块设计

1. **PromptParser**: 提示词解析模块
   - 分割提示词
   - 提取@角色标记

2. **CharacterBinder**: 角色绑定模块
   - 管理参考图
   - 建立角色与图片的映射

3. **ImageGenerator**: 出图模块
   - 调用AI模型API
   - 处理生成结果

---

## 依赖关系

```
US-001 (提示词分割)
    │
    ├── US-002 (角色绑定) ── 依赖US-001的解析结果
    │
    └── US-003 (AI出图) ── 依赖US-002的绑定结果
            │
            └── US-004 (参数配置) ── 可独立
```

---

## 优先级排序

| 优先级   | User Story               | 预估故事点 |
| -------- | ------------------------ | ---------- |
| P0       | US-001: 提示词分割       | 5          |
| P0       | US-002: 角色绑定         | 8          |
| P0       | US-003: AI出图           | 8          |
| P0       | US-007: 三方API配置      | 3          |
| P1       | US-004: 参数配置         | 3          |
| P1       | US-005: 桌面应用基础功能 | 3          |
| P2       | US-006: 参考图管理       | 3          |
| **合计** |                          | **33**     |

---

## 风险评估

1. **AI API稳定性**: 即梦和Banana Pro的API可能存在调用限制或不稳定因素
2. **提示词分割准确性**: NLP分割可能无法覆盖所有场景
3. **角色绑定一致性**: 多角色绑定时可能出现混淆

---

_文档版本: v1.0_  
_创建日期: 2026-02-25_
