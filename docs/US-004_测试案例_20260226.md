# US-004 测试案例

**用户故事**: 出图参数配置  
**标题**: 作为用户，我希望能够配置出图的相关参数  
**测试日期**: 2026-02-26  
**测试人员**:

---

## 验收标准

- [x] 支持配置图片尺寸
- [x] 支持配置生成数量
- [x] 支持配置画质/质量参数
- [x] 参数能够保存为默认配置

---

## 测试用例

### TC-001: 图片尺寸配置

| 项目         | 内容                                                           |
| ------------ | -------------------------------------------------------------- |
| **用例ID**   | TC-001                                                         |
| **测试场景** | 配置图片尺寸                                                   |
| **前置条件** | 应用正常运行，选择 Banana Pro 模型                             |
| **测试步骤** | 1. 在AI生成设置区域找到"图片尺寸"下拉框<br>2. 选择不同尺寸选项 |
| **预期结果** | 尺寸选项包含：512x512, 768x768, 1024x1024, 1024x768, 768x1024  |
| **测试结果** | ✅ 通过                                                        |

---

### TC-002: 生成数量配置

| 项目         | 内容                                                           |
| ------------ | -------------------------------------------------------------- |
| **用例ID**   | TC-002                                                         |
| **测试场景** | 配置生成数量                                                   |
| **前置条件** | 应用正常运行，选择 Banana Pro 模型                             |
| **测试步骤** | 1. 在AI生成设置区域找到"生成数量"下拉框<br>2. 选择不同数量选项 |
| **预期结果** | 数量选项包含：1张, 2张, 4张                                    |
| **测试结果** | ✅ 通过                                                        |

---

### TC-003: 图片质量配置

| 项目         | 内容                                                           |
| ------------ | -------------------------------------------------------------- |
| **用例ID**   | TC-003                                                         |
| **测试场景** | 配置图片质量/画质参数                                          |
| **前置条件** | 应用正常运行，选择 Banana Pro 模型                             |
| **测试步骤** | 1. 在AI生成设置区域找到"图片质量"下拉框<br>2. 选择不同质量选项 |
| **预期结果** | 质量选项包含：标准, 高清, 超清                                 |
| **测试结果** | ✅ 通过                                                        |

---

### TC-004: 保存为默认配置

| 项目         | 内容                                                                                                                |
| ------------ | ------------------------------------------------------------------------------------------------------------------- |
| **用例ID**   | TC-004                                                                                                              |
| **测试场景** | 将当前参数保存为默认配置                                                                                            |
| **前置条件** | 应用正常运行                                                                                                        |
| **测试步骤** | 1. 选择图片尺寸为 "1024x1024"<br>2. 选择生成数量为 "4张"<br>3. 选择图片质量为 "超清"<br>4. 点击"保存为默认配置"按钮 |
| **预期结果** | 显示保存成功提示："生成参数配置已保存为默认"                                                                        |
| **测试结果** | ✅ 通过                                                                                                             |

---

### TC-005: 重新加载已保存的配置

| 项目         | 内容                                                                |
| ------------ | ------------------------------------------------------------------- |
| **用例ID**   | TC-005                                                              |
| **测试场景** | 应用启动后自动加载已保存的生成参数配置                              |
| **前置条件** | 已通过TC-004保存了自定义配置                                        |
| **测试步骤** | 1. 重新启动应用程序<br>2. 进入AI生成区域查看参数设置                |
| **预期结果** | 图片尺寸自动设置为 "1024x1024"，生成数量为 "4张"，图片质量为 "超清" |
| **测试结果** | ✅ 通过                                                             |

---

### TC-006: 后端保存配置命令

| 项目         | 内容                                                                                                                                  |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------- |
| **用例ID**   | TC-006                                                                                                                                |
| **测试场景** | 测试 Rust 后端 `save_generation_config` 命令                                                                                          |
| **前置条件** | Tauri 应用正常运行                                                                                                                    |
| **测试步骤** | 1. 使用 Tauri invoke 调用 `save_generation_config`<br>2. 传入配置参数：model="jimeng", width=768, height=768, count=2, quality="high" |
| **预期结果** | 返回 `true`，配置文件保存到 `generation_config.json`                                                                                  |
| **测试结果** | ✅ 通过                                                                                                                               |

---

### TC-007: 后端加载配置命令

| 项目         | 内容                                                                                      |
| ------------ | ----------------------------------------------------------------------------------------- |
| **用例ID**   | TC-007                                                                                    |
| **测试场景** | 测试 Rust 后端 `load_generation_config` 命令                                              |
| **前置条件** | 已通过 TC-006 保存了配置                                                                  |
| **测试步骤** | 1. 使用 Tauri invoke 调用 `load_generation_config`                                        |
| **预期结果** | 返回保存的配置对象：{model: "jimeng", width: 768, height: 768, count: 2, quality: "high"} |
| **测试结果** | ✅ 通过                                                                                   |

---

### TC-008: 获取默认配置命令

| 项目         | 内容                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------- |
| **用例ID**   | TC-008                                                                                      |
| **测试场景** | 测试 Rust 后端 `get_default_generation_config` 命令                                         |
| **前置条件** | Tauri 应用正常运行                                                                          |
| **测试步骤** | 1. 使用 Tauri invoke 调用 `get_default_generation_config`                                   |
| **预期结果** | 返回默认配置：{model: "seedream", width: 1024, height: 1024, count: 1, quality: "standard"} |
| **测试结果** | ✅ 通过                                                                                     |

---

### TC-009: Seeddream 模型参数配置

| 项目         | 内容                                                                           |
| ------------ | ------------------------------------------------------------------------------ |
| **用例ID**   | TC-009                                                                         |
| **测试场景** | 选择 Seeddream 4.5 模型后显示对应参数                                          |
| **前置条件** | 应用正常运行                                                                   |
| **测试步骤** | 1. 在模型选择下拉框选择 "Seeddream 4.5"<br>2. 观察参数区域变化                 |
| **预期结果** | 显示 Seeddream 特有参数：图片尺寸(1024x1024, 2K, 4K)、组图功能、返回格式、水印 |
| **测试结果** | ✅ 通过                                                                        |

---

### TC-010: Banana Pro 模型参数配置

| 项目         | 内容                                                        |
| ------------ | ----------------------------------------------------------- |
| **用例ID**   | TC-010                                                      |
| **测试场景** | 选择 Banana Pro 模型后显示对应参数                          |
| **前置条件** | 应用正常运行                                                |
| **测试步骤** | 1. 在模型选择下拉框选择 "Banana Pro"<br>2. 观察参数区域变化 |
| **预期结果** | 显示 Banana Pro 参数：图片尺寸、生成数量、图片质量          |
| **测试结果** | ✅ 通过                                                     |

---

### TC-011: API配置测试连接

| 项目         | 内容                                                 |
| ------------ | ---------------------------------------------------- |
| **用例ID**   | TC-011                                               |
| **测试场景** | 使用当前输入的API Key测试连接                        |
| **前置条件** | 应用正常运行，API配置Modal打开                       |
| **测试步骤** | 1. 输入 Base URL 和 API Key<br>2. 点击"测试连接"按钮 |
| **预期结果** | 显示连接成功或失败提示                               |
| **测试结果** | ✅ 通过                                              |

---

### TC-012: Seeddream 生成配置保存

| 项目         | 内容                                                                                       |
| ------------ | ------------------------------------------------------------------------------------------ |
| **用例ID**   | TC-012                                                                                     |
| **测试场景** | 保存 Seeddream 模型配置                                                                    |
| **前置条件** | 应用正常运行                                                                               |
| **测试步骤** | 1. 选择 Seeddream 4.5 模型<br>2. 设置尺寸为 "2K"，组图功能为 "自动"，无水印<br>3. 点击保存 |
| **预期结果** | 显示保存成功提示，配置文件包含 Seedream 特有参数                                           |
| **测试结果** | ✅ 通过                                                                                    |

---

### TC-013: Seeddream 配置重新加载

| 项目         | 内容                                                |
| ------------ | --------------------------------------------------- |
| **用例ID**   | TC-013                                              |
| **测试场景** | 重启应用后 Seeddream 配置正确加载                   |
| **前置条件** | 已通过 TC-012 保存了 Seedream 配置                 |
| **测试步骤** | 1. 重新启动应用程序<br>2. 选择 Seeddream 4.5 模型  |
| **预期结果** | 尺寸自动设置为 "2K"，组图功能为 "自动"，水印为 "无" |
| **测试结果** | ✅ 通过                                             |

---

### TC-014: 角色参考图绑定功能

| 项目         | 内容                                                                              |
| ------------ | --------------------------------------------------------------------------------- |
| **用例ID**   | TC-014                                                                            |
| **测试场景** | 上传角色参考图并绑定到角色                                                        |
| **前置条件** | 应用正常运行                                                                      |
| **测试步骤** | 1. 解析包含角色的提示词<br>2. 点击角色绑定按钮<br>3. 上传参考图<br>4. 点击确认绑定 |
| **预期结果** | 绑定成功提示，角色显示已绑定标记                                                  |
| **测试结果** | ✅ 通过                                                                           |

---

### TC-015: Seeddream API 传入角色参考图

| 项目         | 内容                                                                              |
| ------------ | --------------------------------------------------------------------------------- |
| **用例ID**   | TC-015                                                                            |
| **测试场景** | 使用 Seeddream 模型生成图片时传入角色参考图                                         |
| **前置条件** | 已绑定角色参考图                                                                  |
| **测试步骤** | 1. 选择 Seeddream 4.5 模型<br>2. 输入包含已绑定角色的提示词<br>3. 点击生成图片    |
| **预期结果** | 生成图片时正确传入角色参考图URL到API的images参数                                    |
| **测试结果** | ✅ 通过                                                                           |

---

### TC-016: API请求参数兼容性

| 项目         | 内容                                                              |
| ------------ | ----------------------------------------------------------------- |
| **用例ID**   | TC-016                                                            |
| **测试场景** | 测试后端API支持驼峰命名和下划线命名                                |
| **前置条件** | Tauri应用正常运行                                                 |
| **测试步骤** | 1. 调用角色绑定API (使用camelCase参数)<br>2. 调用角色绑定API (使用snake_case参数) |
| **预期结果** | 两种格式都能正确解析                                             |
| **测试结果** | ✅ 通过                                                           |

---

### TC-017: Seeddream API 生成图片

| 项目         | 内容                                                              |
| ------------ | ----------------------------------------------------------------- |
| **用例ID**   | TC-017                                                            |
| **测试场景** | 使用Seeddream模型调用外部API生成图片                               |
| **前置条件** | 已配置API Key                                                     |
| **测试步骤** | 1. 选择Seeddream模型<br>2. 输入提示词<br>3. 点击生成              |
| **预期结果** | 成功调用API并返回图片URL                                          |
| **测试结果** | ✅ 通过 (API连接正常时)                                           |

---

## 测试总结

| 指标         | 结果 |
| ------------ | ---- |
| **总用例数** | 17   |
| **通过**     | 17   |
| **失败**     | 0    |
| **通过率**   | 100% |

---

## 测试记录

| 日期       | 测试人员 | 测试用例           | 结果     |
| ---------- | -------- | ------------------ | -------- |
| 2026-02-26 | 开发人员 | TC-001 ~ TC-017    | 全部通过 |

---

## 结论

US-004 出图参数配置功能已完成开发，所有验收标准均已实现：

1. ✅ 支持配置图片尺寸 - Banana Pro: 5种尺寸，Seeddream: 3种尺寸(1K, 2K, 4K)
2. ✅ 支持配置生成数量 - Banana Pro: 1/2/4张，Seeddream: 通过组图功能控制
3. ✅ 支持配置画质/质量参数 - Banana Pro: 标准/高清/超清，Seeddream: 返回格式/水印
4. ✅ 参数能够保存为默认配置 - 支持保存和自动加载，包括模型特有参数
5. ✅ 角色参考图绑定功能 - 支持上传参考图并绑定到角色
6. ✅ Seeddream API 角色参考图支持 - 生成时自动传入已绑定的参考图

**功能状态**: ✅ 已完成
