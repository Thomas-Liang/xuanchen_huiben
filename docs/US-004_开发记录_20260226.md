# US-004 开发记录

**用户故事**: 出图参数配置  
**标题**: 作为用户，我希望能够配置出图的相关参数  
**开发日期**: 2026-02-26  
**状态**: ✅ 已完成

---

## 需求概述

用户需要能够配置AI图片生成的相关参数，包括：
- 图片尺寸
- 生成数量
- 图片质量/画质
- 保存为默认配置

---

## 完成的工作

### 1. 类型定义 (src/types/index.ts)

新增 `GenerationConfig` 接口：
```typescript
interface GenerationConfig {
  model: 'seedream' | 'banana_pro';
  width: number;
  height: number;
  count: number;
  quality: 'standard' | 'high' | 'ultra';
  size?: string;
  sequential_image_generation?: 'auto' | 'disabled';
  response_format?: 'url' | 'b64_json';
  watermark?: boolean;
}
```

### 2. 后端 Rust 命令 (src-tauri/src/commands/image_generator.rs)

新增命令：
- `save_generation_config` - 保存生成参数配置到文件
- `load_generation_config` - 从文件加载生成参数配置
- `get_default_generation_config` - 获取默认配置

### 3. Seeddream 4.5 模型支持

- 新增 `seedream` 模型选项（替换原有的 jimeng）
- 新增 `call_seedream_api` 函数
- 默认API地址: `https://api.zhongzhuan.chat`

前端根据选择模型显示不同参数：
- **Seeddream**: 图片尺寸(1K/2K/4K)、组图功能、返回格式、水印
- **Banana Pro**: 图片尺寸、生成数量、图片质量

### 4. 角色参考图绑定

- Seeddream 模型支持通过 `images` 参数传入角色参考图
- 角色绑定 API 支持驼峰命名和下划线命名兼容

### 5. API 请求格式优化

- 后端 API 使用 `serde_json::Value` 接收请求，灵活处理各种字段命名
- 前端统一使用 snake_case 格式发送请求

---

## 修改的文件

| 文件 | 修改内容 |
|------|---------|
| `src/types/index.ts` | 新增 GenerationConfig 类型 |
| `src/api.ts` | 新增 API 函数，修复参数格式 |
| `src/App.tsx` | 前端UI，模型选择，参数配置 |
| `src/store/index.ts` | 更新默认配置 |
| `src-tauri/src/commands/image_generator.rs` | 新增命令，Seeddream API |
| `src-tauri/src/api.rs` | 新增API端点，JSON解析优化 |
| `src-tauri/src/lib.rs` | 注册新命令 |

---

## 验收标准

- [x] 支持配置图片尺寸
- [x] 支持配置生成数量
- [x] 支持配置画质/质量参数
- [x] 参数能够保存为默认配置

---

## 后续优化

- 完善角色绑定功能的持久化存储
- 优化网络连接处理
- 增加API重试机制
