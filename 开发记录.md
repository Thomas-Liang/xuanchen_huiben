# AI绘画 - 开发记录

## Sprint 0: 项目初始化

### 2026-02-25

#### 完成的工作

1. **Tauri + React 项目初始化**
   - 使用 `npm create tauri-app` 创建项目
   - 技术栈: React 18 + TypeScript + Vite + Tauri 2.x
   - 项目名称: xuanchen-huiben

2. **开发环境配置**
   - 安装 ESLint、Prettier
   - 安装 Zustand (状态管理)
   - 安装 Axios (HTTP请求)
   - 安装 Ant Design (UI组件)
   - 配置 `.eslintrc.json` 和 `.prettierrc`

3. **项目结构搭建**
   ```
   src/
   ├── components/     # React组件
   ├── hooks/          # 自定义Hooks
   ├── types/          # TypeScript类型定义
   ├── services/       # API服务
   ├── store/          # Zustand状态管理
   └── utils/          # 工具函数

   src-tauri/
   └── src/
       └── commands/   # Tauri命令
   ```

4. **核心类型定义** (`src/types/index.ts`)
   - `PromptSegment` - 提示词分段
   - `ParsedPrompt` - 解析结果
   - `CharacterRef` - 角色引用
   - `CharacterBinding` - 角色绑定
   - `ImageGenerationParams` - 出图参数
   - `APIConfig` - API配置

5. **状态管理** (`src/store/index.ts`)
   - 使用 Zustand + persist 中间件
   - 管理 API配置、解析结果、角色绑定、出图参数

6. **Rust后端命令** (`src-tauri/src/lib.rs`)
   - `parse_prompt` - 提示词解析（提取@角色、分段）
   - 支持中文字符识别

7. **前端界面** (`src/App.tsx`)
   - 提示词输入框
   - 解析结果显示（角色列表、分段结果）
   - Ant Design UI组件

8. **配置文件更新**
   - `tauri.conf.json` - 应用名称、大小、窗口配置
   - `package.json` - 项目名称、脚本配置
   - `Cargo.toml` - Rust依赖

#### 遇到的问题

1. **Rust编译链接问题 (未解决)**
   - MSVC链接器环境配置复杂
   - 当前环境: VS Build Tools 14.44 + Windows SDK 10.0.26100
   - 错误: `LINK : fatal error LNK1104: 无法打开文件"msvcrt.lib"`
   - 需要在VS Developer Command Prompt中手动编译

#### 待完成

- [ ] 解决Rust编译环境问题
- [ ] US-001 提示词分割功能完善
- [ ] US-002 角色绑定功能
- [ ] US-003 AI出图功能
- [ ] US-004 参数配置
- [ ] US-005 桌面应用基础功能
- [ ] US-007 三方API配置

### 编译说明

由于Rust编译环境配置复杂，请在VS Developer Command Prompt中手动编译：

```cmd
REM 方法1: 使用提供的脚本
cd C:\Users\Administrator\xuanchen_huiben
build.bat

REM 方法2: 手动命令
call "D:\Program Files\vs\VC\Auxiliary\Build\vcvars64.bat"
cd src-tauri
cargo build
```

---

## 技术架构

```
┌─────────────────────────────────────────┐
│         Tauri Desktop App                │
│  ┌─────────────────┐  ┌──────────────┐  │
│  │ React Frontend  │◀▶│ Tauri Cmds  │  │
│  │ (TypeScript)    │  │   (Rust)     │  │
│  └─────────────────┘  └──────────────┘  │
└─────────────────────────────────────────┘
                   │
       ┌───────────▼───────────┐
       │   AI Model API        │
       │ (即梦 / Banana Pro)   │
       └───────────────────────┘
```

## 依赖版本

- React: 19.1.0
- TypeScript: 5.8.3
- Vite: 7.0.4
- Tauri: 2.x
- Zustand: 5.x
- Ant Design: 6.x
- Axios: 1.x
